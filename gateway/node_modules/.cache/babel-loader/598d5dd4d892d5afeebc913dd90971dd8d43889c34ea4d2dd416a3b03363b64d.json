{"ast":null,"code":"import Base from 'claygl/src/core/Base';\nimport retrieve from './retrieve';\n/**\n * @alias module:echarts-gl/util/Roam2DControl\n */\n\nvar Roam2DControl = Base.extend(function () {\n  return {\n    /**\n     * @type {module:zrender~ZRender}\n     */\n    zr: null,\n    /**\n     * @type {module:echarts-gl/core/ViewGL}\n     */\n    viewGL: null,\n    minZoom: 0.2,\n    maxZoom: 5,\n    _needsUpdate: false,\n    _dx: 0,\n    _dy: 0,\n    _zoom: 1\n  };\n}, function () {\n  // Each Roam2DControl has it's own handler\n  this._mouseDownHandler = this._mouseDownHandler.bind(this);\n  this._mouseWheelHandler = this._mouseWheelHandler.bind(this);\n  this._mouseMoveHandler = this._mouseMoveHandler.bind(this);\n  this._mouseUpHandler = this._mouseUpHandler.bind(this);\n  this._update = this._update.bind(this);\n}, {\n  init: function () {\n    var zr = this.zr;\n    zr.on('mousedown', this._mouseDownHandler);\n    zr.on('mousewheel', this._mouseWheelHandler);\n    zr.on('globalout', this._mouseUpHandler);\n    zr.animation.on('frame', this._update);\n  },\n  setTarget: function (target) {\n    this._target = target;\n  },\n  setZoom: function (zoom) {\n    this._zoom = Math.max(Math.min(zoom, this.maxZoom), this.minZoom);\n    this._needsUpdate = true;\n  },\n  setOffset: function (offset) {\n    this._dx = offset[0];\n    this._dy = offset[1];\n    this._needsUpdate = true;\n  },\n  getZoom: function () {\n    return this._zoom;\n  },\n  getOffset: function () {\n    return [this._dx, this._dy];\n  },\n  _update: function () {\n    if (!this._target) {\n      return;\n    }\n    if (!this._needsUpdate) {\n      return;\n    }\n    var target = this._target;\n    var scale = this._zoom;\n    target.position.x = this._dx;\n    target.position.y = this._dy;\n    target.scale.set(scale, scale, scale);\n    this.zr.refresh();\n    this._needsUpdate = false;\n    this.trigger('update');\n  },\n  _mouseDownHandler: function (e) {\n    if (e.target) {\n      return;\n    }\n    var x = e.offsetX;\n    var y = e.offsetY;\n    if (this.viewGL && !this.viewGL.containPoint(x, y)) {\n      return;\n    }\n    this.zr.on('mousemove', this._mouseMoveHandler);\n    this.zr.on('mouseup', this._mouseUpHandler);\n    var pos = this._convertPos(x, y);\n    this._x = pos.x;\n    this._y = pos.y;\n  },\n  // Convert pos from screen space to viewspace.\n  _convertPos: function (x, y) {\n    var camera = this.viewGL.camera;\n    var viewport = this.viewGL.viewport; // PENDING\n\n    return {\n      x: (x - viewport.x) / viewport.width * (camera.right - camera.left) + camera.left,\n      y: (y - viewport.y) / viewport.height * (camera.bottom - camera.top) + camera.top\n    };\n  },\n  _mouseMoveHandler: function (e) {\n    var pos = this._convertPos(e.offsetX, e.offsetY);\n    this._dx += pos.x - this._x;\n    this._dy += pos.y - this._y;\n    this._x = pos.x;\n    this._y = pos.y;\n    this._needsUpdate = true;\n  },\n  _mouseUpHandler: function (e) {\n    this.zr.off('mousemove', this._mouseMoveHandler);\n    this.zr.off('mouseup', this._mouseUpHandler);\n  },\n  _mouseWheelHandler: function (e) {\n    e = e.event;\n    var delta = e.wheelDelta // Webkit\n    || -e.detail; // Firefox\n\n    if (delta === 0) {\n      return;\n    }\n    var x = e.offsetX;\n    var y = e.offsetY;\n    if (this.viewGL && !this.viewGL.containPoint(x, y)) {\n      return;\n    }\n    var zoomScale = delta > 0 ? 1.1 : 0.9;\n    var newZoom = Math.max(Math.min(this._zoom * zoomScale, this.maxZoom), this.minZoom);\n    zoomScale = newZoom / this._zoom;\n    var pos = this._convertPos(x, y);\n    var fixX = (pos.x - this._dx) * (zoomScale - 1);\n    var fixY = (pos.y - this._dy) * (zoomScale - 1);\n    this._dx -= fixX;\n    this._dy -= fixY;\n    this._zoom = newZoom;\n    this._needsUpdate = true;\n  },\n  dispose: function () {\n    var zr = this.zr;\n    zr.off('mousedown', this._mouseDownHandler);\n    zr.off('mousemove', this._mouseMoveHandler);\n    zr.off('mouseup', this._mouseUpHandler);\n    zr.off('mousewheel', this._mouseWheelHandler);\n    zr.off('globalout', this._mouseUpHandler);\n    zr.animation.off('frame', this._update);\n  }\n});\nexport default Roam2DControl;","map":{"version":3,"names":["Base","retrieve","Roam2DControl","extend","zr","viewGL","minZoom","maxZoom","_needsUpdate","_dx","_dy","_zoom","_mouseDownHandler","bind","_mouseWheelHandler","_mouseMoveHandler","_mouseUpHandler","_update","init","on","animation","setTarget","target","_target","setZoom","zoom","Math","max","min","setOffset","offset","getZoom","getOffset","scale","position","x","y","set","refresh","trigger","e","offsetX","offsetY","containPoint","pos","_convertPos","_x","_y","camera","viewport","width","right","left","height","bottom","top","off","event","delta","wheelDelta","detail","zoomScale","newZoom","fixX","fixY","dispose"],"sources":["E:/mytest/node_modules/echarts-gl/lib/util/Roam2DControl.js"],"sourcesContent":["import Base from 'claygl/src/core/Base';\nimport retrieve from './retrieve';\n/**\n * @alias module:echarts-gl/util/Roam2DControl\n */\n\nvar Roam2DControl = Base.extend(function () {\n  return {\n    /**\n     * @type {module:zrender~ZRender}\n     */\n    zr: null,\n\n    /**\n     * @type {module:echarts-gl/core/ViewGL}\n     */\n    viewGL: null,\n    minZoom: 0.2,\n    maxZoom: 5,\n    _needsUpdate: false,\n    _dx: 0,\n    _dy: 0,\n    _zoom: 1\n  };\n}, function () {\n  // Each Roam2DControl has it's own handler\n  this._mouseDownHandler = this._mouseDownHandler.bind(this);\n  this._mouseWheelHandler = this._mouseWheelHandler.bind(this);\n  this._mouseMoveHandler = this._mouseMoveHandler.bind(this);\n  this._mouseUpHandler = this._mouseUpHandler.bind(this);\n  this._update = this._update.bind(this);\n}, {\n  init: function () {\n    var zr = this.zr;\n    zr.on('mousedown', this._mouseDownHandler);\n    zr.on('mousewheel', this._mouseWheelHandler);\n    zr.on('globalout', this._mouseUpHandler);\n    zr.animation.on('frame', this._update);\n  },\n  setTarget: function (target) {\n    this._target = target;\n  },\n  setZoom: function (zoom) {\n    this._zoom = Math.max(Math.min(zoom, this.maxZoom), this.minZoom);\n    this._needsUpdate = true;\n  },\n  setOffset: function (offset) {\n    this._dx = offset[0];\n    this._dy = offset[1];\n    this._needsUpdate = true;\n  },\n  getZoom: function () {\n    return this._zoom;\n  },\n  getOffset: function () {\n    return [this._dx, this._dy];\n  },\n  _update: function () {\n    if (!this._target) {\n      return;\n    }\n\n    if (!this._needsUpdate) {\n      return;\n    }\n\n    var target = this._target;\n    var scale = this._zoom;\n    target.position.x = this._dx;\n    target.position.y = this._dy;\n    target.scale.set(scale, scale, scale);\n    this.zr.refresh();\n    this._needsUpdate = false;\n    this.trigger('update');\n  },\n  _mouseDownHandler: function (e) {\n    if (e.target) {\n      return;\n    }\n\n    var x = e.offsetX;\n    var y = e.offsetY;\n\n    if (this.viewGL && !this.viewGL.containPoint(x, y)) {\n      return;\n    }\n\n    this.zr.on('mousemove', this._mouseMoveHandler);\n    this.zr.on('mouseup', this._mouseUpHandler);\n\n    var pos = this._convertPos(x, y);\n\n    this._x = pos.x;\n    this._y = pos.y;\n  },\n  // Convert pos from screen space to viewspace.\n  _convertPos: function (x, y) {\n    var camera = this.viewGL.camera;\n    var viewport = this.viewGL.viewport; // PENDING\n\n    return {\n      x: (x - viewport.x) / viewport.width * (camera.right - camera.left) + camera.left,\n      y: (y - viewport.y) / viewport.height * (camera.bottom - camera.top) + camera.top\n    };\n  },\n  _mouseMoveHandler: function (e) {\n    var pos = this._convertPos(e.offsetX, e.offsetY);\n\n    this._dx += pos.x - this._x;\n    this._dy += pos.y - this._y;\n    this._x = pos.x;\n    this._y = pos.y;\n    this._needsUpdate = true;\n  },\n  _mouseUpHandler: function (e) {\n    this.zr.off('mousemove', this._mouseMoveHandler);\n    this.zr.off('mouseup', this._mouseUpHandler);\n  },\n  _mouseWheelHandler: function (e) {\n    e = e.event;\n    var delta = e.wheelDelta // Webkit\n    || -e.detail; // Firefox\n\n    if (delta === 0) {\n      return;\n    }\n\n    var x = e.offsetX;\n    var y = e.offsetY;\n\n    if (this.viewGL && !this.viewGL.containPoint(x, y)) {\n      return;\n    }\n\n    var zoomScale = delta > 0 ? 1.1 : 0.9;\n    var newZoom = Math.max(Math.min(this._zoom * zoomScale, this.maxZoom), this.minZoom);\n    zoomScale = newZoom / this._zoom;\n\n    var pos = this._convertPos(x, y);\n\n    var fixX = (pos.x - this._dx) * (zoomScale - 1);\n    var fixY = (pos.y - this._dy) * (zoomScale - 1);\n    this._dx -= fixX;\n    this._dy -= fixY;\n    this._zoom = newZoom;\n    this._needsUpdate = true;\n  },\n  dispose: function () {\n    var zr = this.zr;\n    zr.off('mousedown', this._mouseDownHandler);\n    zr.off('mousemove', this._mouseMoveHandler);\n    zr.off('mouseup', this._mouseUpHandler);\n    zr.off('mousewheel', this._mouseWheelHandler);\n    zr.off('globalout', this._mouseUpHandler);\n    zr.animation.off('frame', this._update);\n  }\n});\nexport default Roam2DControl;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}