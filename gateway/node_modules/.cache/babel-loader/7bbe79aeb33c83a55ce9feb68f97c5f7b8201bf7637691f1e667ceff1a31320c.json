{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport retrieve from '../../util/retrieve';\nimport graphicGL from '../../util/graphicGL';\nimport ViewGL from '../../core/ViewGL';\nexport default function (serviceComponentType, ServiceCtor, afterCreate) {\n  function resizeMapService3D(mapService3DModel, api) {\n    var width = api.getWidth();\n    var height = api.getHeight();\n    var dpr = api.getDevicePixelRatio();\n    this.viewGL.setViewport(0, 0, width, height, dpr);\n    this.width = width;\n    this.height = height;\n    this.altitudeScale = mapService3DModel.get('altitudeScale');\n    this.boxHeight = mapService3DModel.get('boxHeight'); // this.updateTransform();\n  }\n  function updateService3D(ecModel, api) {\n    if (this.model.get('boxHeight') === 'auto') {\n      return;\n    }\n    var altitudeDataExtent = [Infinity, -Infinity];\n    ecModel.eachSeries(function (seriesModel) {\n      if (seriesModel.coordinateSystem !== this) {\n        return;\n      } // Get altitude data extent.\n\n      var data = seriesModel.getData();\n      var altDim = seriesModel.coordDimToDataDim('alt')[0];\n      if (altDim) {\n        // TODO altitiude is in coords of lines.\n        var dataExtent = data.getDataExtent(altDim, true);\n        altitudeDataExtent[0] = Math.min(altitudeDataExtent[0], dataExtent[0]);\n        altitudeDataExtent[1] = Math.max(altitudeDataExtent[1], dataExtent[1]);\n      }\n    }, this);\n    if (altitudeDataExtent && isFinite(altitudeDataExtent[1] - altitudeDataExtent[0])) {\n      this.altitudeExtent = altitudeDataExtent;\n    }\n  }\n  return {\n    dimensions: ServiceCtor.prototype.dimensions,\n    create: function (ecModel, api) {\n      var mapService3DList = [];\n      ecModel.eachComponent(serviceComponentType, function (mapService3DModel) {\n        var viewGL = mapService3DModel.__viewGL;\n        if (!viewGL) {\n          viewGL = mapService3DModel.__viewGL = new ViewGL();\n          viewGL.setRootNode(new graphicGL.Node());\n        }\n        var mapService3DCoordSys = new ServiceCtor();\n        mapService3DCoordSys.viewGL = mapService3DModel.__viewGL; // Inject resize\n\n        mapService3DCoordSys.resize = resizeMapService3D;\n        mapService3DCoordSys.resize(mapService3DModel, api);\n        mapService3DList.push(mapService3DCoordSys);\n        mapService3DModel.coordinateSystem = mapService3DCoordSys;\n        mapService3DCoordSys.model = mapService3DModel;\n        mapService3DCoordSys.update = updateService3D;\n      });\n      ecModel.eachSeries(function (seriesModel) {\n        if (seriesModel.get('coordinateSystem') === serviceComponentType) {\n          var mapService3DModel = seriesModel.getReferringComponents(serviceComponentType).models[0];\n          if (!mapService3DModel) {\n            mapService3DModel = ecModel.getComponent(serviceComponentType);\n          }\n          if (!mapService3DModel) {\n            throw new Error(serviceComponentType + ' \"' + retrieve.firstNotNull(seriesModel.get(serviceComponentType + 'Index'), seriesModel.get(serviceComponentType + 'Id'), 0) + '\" not found');\n          }\n          seriesModel.coordinateSystem = mapService3DModel.coordinateSystem;\n        }\n      });\n      afterCreate && afterCreate(mapService3DList, ecModel, api);\n      return mapService3DList;\n    }\n  };\n}","map":{"version":3,"names":["retrieve","graphicGL","ViewGL","serviceComponentType","ServiceCtor","afterCreate","resizeMapService3D","mapService3DModel","api","width","getWidth","height","getHeight","dpr","getDevicePixelRatio","viewGL","setViewport","altitudeScale","get","boxHeight","updateService3D","ecModel","model","altitudeDataExtent","Infinity","eachSeries","seriesModel","coordinateSystem","data","getData","altDim","coordDimToDataDim","dataExtent","getDataExtent","Math","min","max","isFinite","altitudeExtent","dimensions","prototype","create","mapService3DList","eachComponent","__viewGL","setRootNode","Node","mapService3DCoordSys","resize","push","update","getReferringComponents","models","getComponent","Error","firstNotNull"],"sources":["E:/QuestionairePlanet_Fronted/mytest/node_modules/echarts-gl/lib/coord/mapServiceCommon/createMapService3DCreator.js"],"sourcesContent":["import retrieve from '../../util/retrieve';\nimport graphicGL from '../../util/graphicGL';\nimport ViewGL from '../../core/ViewGL';\nexport default function (serviceComponentType, ServiceCtor, afterCreate) {\n  function resizeMapService3D(mapService3DModel, api) {\n    var width = api.getWidth();\n    var height = api.getHeight();\n    var dpr = api.getDevicePixelRatio();\n    this.viewGL.setViewport(0, 0, width, height, dpr);\n    this.width = width;\n    this.height = height;\n    this.altitudeScale = mapService3DModel.get('altitudeScale');\n    this.boxHeight = mapService3DModel.get('boxHeight'); // this.updateTransform();\n  }\n\n  function updateService3D(ecModel, api) {\n    if (this.model.get('boxHeight') === 'auto') {\n      return;\n    }\n\n    var altitudeDataExtent = [Infinity, -Infinity];\n    ecModel.eachSeries(function (seriesModel) {\n      if (seriesModel.coordinateSystem !== this) {\n        return;\n      } // Get altitude data extent.\n\n\n      var data = seriesModel.getData();\n      var altDim = seriesModel.coordDimToDataDim('alt')[0];\n\n      if (altDim) {\n        // TODO altitiude is in coords of lines.\n        var dataExtent = data.getDataExtent(altDim, true);\n        altitudeDataExtent[0] = Math.min(altitudeDataExtent[0], dataExtent[0]);\n        altitudeDataExtent[1] = Math.max(altitudeDataExtent[1], dataExtent[1]);\n      }\n    }, this);\n\n    if (altitudeDataExtent && isFinite(altitudeDataExtent[1] - altitudeDataExtent[0])) {\n      this.altitudeExtent = altitudeDataExtent;\n    }\n  }\n\n  return {\n    dimensions: ServiceCtor.prototype.dimensions,\n    create: function (ecModel, api) {\n      var mapService3DList = [];\n      ecModel.eachComponent(serviceComponentType, function (mapService3DModel) {\n        var viewGL = mapService3DModel.__viewGL;\n\n        if (!viewGL) {\n          viewGL = mapService3DModel.__viewGL = new ViewGL();\n          viewGL.setRootNode(new graphicGL.Node());\n        }\n\n        var mapService3DCoordSys = new ServiceCtor();\n        mapService3DCoordSys.viewGL = mapService3DModel.__viewGL; // Inject resize\n\n        mapService3DCoordSys.resize = resizeMapService3D;\n        mapService3DCoordSys.resize(mapService3DModel, api);\n        mapService3DList.push(mapService3DCoordSys);\n        mapService3DModel.coordinateSystem = mapService3DCoordSys;\n        mapService3DCoordSys.model = mapService3DModel;\n        mapService3DCoordSys.update = updateService3D;\n      });\n      ecModel.eachSeries(function (seriesModel) {\n        if (seriesModel.get('coordinateSystem') === serviceComponentType) {\n          var mapService3DModel = seriesModel.getReferringComponents(serviceComponentType).models[0];\n\n          if (!mapService3DModel) {\n            mapService3DModel = ecModel.getComponent(serviceComponentType);\n          }\n\n          if (!mapService3DModel) {\n            throw new Error(serviceComponentType + ' \"' + retrieve.firstNotNull(seriesModel.get(serviceComponentType + 'Index'), seriesModel.get(serviceComponentType + 'Id'), 0) + '\" not found');\n          }\n\n          seriesModel.coordinateSystem = mapService3DModel.coordinateSystem;\n        }\n      });\n      afterCreate && afterCreate(mapService3DList, ecModel, api);\n      return mapService3DList;\n    }\n  };\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}