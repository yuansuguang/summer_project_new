{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n/**\n * Provide WebGL layer to zrender. Which is rendered on top of clay.\n *\n *\n * Relationship between zrender, LayerGL(renderer) and ViewGL(Scene, Camera, Viewport)\n *           zrender\n *           /     \\\n *      LayerGL   LayerGL\n *    (renderer) (renderer)\n *      /     \\\n *  ViewGL   ViewGL\n */\nimport * as echarts from 'echarts/lib/echarts';\nimport Renderer from 'claygl/src/Renderer';\nimport RayPicking from 'claygl/src/picking/RayPicking';\nimport Texture from 'claygl/src/Texture';\nimport graphicGL from '../util/graphicGL'; // PENDING, clay. notifier is same with zrender Eventful\n\nimport notifier from 'claygl/src/core/mixin/notifier';\nimport requestAnimationFrame from 'zrender/lib/animation/requestAnimationFrame';\n/**\n * @constructor\n * @alias module:echarts-gl/core/LayerGL\n * @param {string} id Layer ID\n * @param {module:zrender/ZRender} zr\n */\n\nvar LayerGL = function (id, zr) {\n  /**\n   * Layer ID\n   * @type {string}\n   */\n  this.id = id;\n  /**\n   * @type {module:zrender/ZRender}\n   */\n\n  this.zr = zr;\n  /**\n   * @type {clay.Renderer}\n   */\n\n  try {\n    this.renderer = new Renderer({\n      clearBit: 0,\n      devicePixelRatio: zr.painter.dpr,\n      preserveDrawingBuffer: true,\n      // PENDING\n      premultipliedAlpha: true\n    });\n    this.renderer.resize(zr.painter.getWidth(), zr.painter.getHeight());\n  } catch (e) {\n    this.renderer = null;\n    this.dom = document.createElement('div');\n    this.dom.style.cssText = 'position:absolute; left: 0; top: 0; right: 0; bottom: 0;';\n    this.dom.className = 'ecgl-nowebgl';\n    this.dom.innerHTML = 'Sorry, your browser does not support WebGL';\n    console.error(e);\n    return;\n  }\n  this.onglobalout = this.onglobalout.bind(this);\n  zr.on('globalout', this.onglobalout);\n  /**\n   * Canvas dom for webgl rendering\n   * @type {HTMLCanvasElement}\n   */\n\n  this.dom = this.renderer.canvas;\n  var style = this.dom.style;\n  style.position = 'absolute';\n  style.left = '0';\n  style.top = '0';\n  /**\n   * @type {Array.<clay.Scene>}\n   */\n\n  this.views = [];\n  this._picking = new RayPicking({\n    renderer: this.renderer\n  });\n  this._viewsToDispose = [];\n  /**\n   * Current accumulating id.\n   */\n\n  this._accumulatingId = 0;\n  this._zrEventProxy = new echarts.graphic.Rect({\n    shape: {\n      x: -1,\n      y: -1,\n      width: 2,\n      height: 2\n    },\n    // FIXME Better solution.\n    __isGLToZRProxy: true\n  });\n  this._backgroundColor = null;\n  this._disposed = false;\n};\nLayerGL.prototype.setUnpainted = function () {};\n/**\n * @param {module:echarts-gl/core/ViewGL} view\n */\n\nLayerGL.prototype.addView = function (view) {\n  if (view.layer === this) {\n    return;\n  } // If needs to dispose in this layer. unmark it.\n\n  var idx = this._viewsToDispose.indexOf(view);\n  if (idx >= 0) {\n    this._viewsToDispose.splice(idx, 1);\n  }\n  this.views.push(view);\n  view.layer = this;\n  var zr = this.zr;\n  view.scene.traverse(function (node) {\n    node.__zr = zr;\n    if (node.addAnimatorsToZr) {\n      node.addAnimatorsToZr(zr);\n    }\n  });\n};\nfunction removeFromZr(node) {\n  var zr = node.__zr;\n  node.__zr = null;\n  if (zr && node.removeAnimatorsFromZr) {\n    node.removeAnimatorsFromZr(zr);\n  }\n}\n/**\n * @param {module:echarts-gl/core/ViewGL} view\n */\n\nLayerGL.prototype.removeView = function (view) {\n  if (view.layer !== this) {\n    return;\n  }\n  var idx = this.views.indexOf(view);\n  if (idx >= 0) {\n    this.views.splice(idx, 1);\n    view.scene.traverse(removeFromZr, this);\n    view.layer = null; // Mark to dispose in this layer.\n\n    this._viewsToDispose.push(view);\n  }\n};\n/**\n * Remove all views\n */\n\nLayerGL.prototype.removeViewsAll = function () {\n  this.views.forEach(function (view) {\n    view.scene.traverse(removeFromZr, this);\n    view.layer = null; // Mark to dispose in this layer.\n\n    this._viewsToDispose.push(view);\n  }, this);\n  this.views.length = 0;\n};\n/**\n * Resize the canvas and viewport, will be invoked by zrender\n * @param  {number} width\n * @param  {number} height\n */\n\nLayerGL.prototype.resize = function (width, height) {\n  var renderer = this.renderer;\n  renderer.resize(width, height);\n};\n/**\n * Clear color and depth\n * @return {[type]} [description]\n */\n\nLayerGL.prototype.clear = function () {\n  var gl = this.renderer.gl;\n  var clearColor = this._backgroundColor || [0, 0, 0, 0];\n  gl.clearColor(clearColor[0], clearColor[1], clearColor[2], clearColor[3]);\n  gl.depthMask(true);\n  gl.colorMask(true, true, true, true);\n  gl.clear(gl.DEPTH_BUFFER_BIT | gl.COLOR_BUFFER_BIT);\n};\n/**\n * Clear depth\n */\n\nLayerGL.prototype.clearDepth = function () {\n  var gl = this.renderer.gl;\n  gl.clear(gl.DEPTH_BUFFER_BIT);\n};\n/**\n * Clear color\n */\n\nLayerGL.prototype.clearColor = function () {\n  var gl = this.renderer.gl;\n  gl.clearColor(0, 0, 0, 0);\n  gl.clear(gl.COLOR_BUFFER_BIT);\n};\n/**\n * Mark layer to refresh next tick\n */\n\nLayerGL.prototype.needsRefresh = function () {\n  this.zr.refresh();\n};\n/**\n * Refresh the layer, will be invoked by zrender\n */\n\nLayerGL.prototype.refresh = function (bgColor) {\n  this._backgroundColor = bgColor ? graphicGL.parseColor(bgColor) : [0, 0, 0, 0];\n  this.renderer.clearColor = this._backgroundColor;\n  for (var i = 0; i < this.views.length; i++) {\n    this.views[i].prepareRender(this.renderer);\n  }\n  this._doRender(false); // Auto dispose unused resources on GPU, like program(shader), texture, geometry(buffers)\n\n  this._trackAndClean(); // Dispose trashed views\n\n  for (var i = 0; i < this._viewsToDispose.length; i++) {\n    this._viewsToDispose[i].dispose(this.renderer);\n  }\n  this._viewsToDispose.length = 0;\n  this._startAccumulating();\n};\nLayerGL.prototype.renderToCanvas = function (ctx) {\n  // PENDING will block the page\n  this._startAccumulating(true);\n  ctx.drawImage(this.dom, 0, 0, ctx.canvas.width, ctx.canvas.height);\n};\nLayerGL.prototype._doRender = function (accumulating) {\n  this.clear();\n  this.renderer.saveViewport();\n  for (var i = 0; i < this.views.length; i++) {\n    this.views[i].render(this.renderer, accumulating);\n  }\n  this.renderer.restoreViewport();\n};\n/**\n * Stop accumulating\n */\n\nLayerGL.prototype._stopAccumulating = function () {\n  this._accumulatingId = 0;\n  clearTimeout(this._accumulatingTimeout);\n};\nvar accumulatingId = 1;\n/**\n * Start accumulating all the views.\n * Accumulating is for antialising and have more sampling in SSAO\n * @private\n */\n\nLayerGL.prototype._startAccumulating = function (immediate) {\n  var self = this;\n  this._stopAccumulating();\n  var needsAccumulate = false;\n  for (var i = 0; i < this.views.length; i++) {\n    needsAccumulate = this.views[i].needsAccumulate() || needsAccumulate;\n  }\n  if (!needsAccumulate) {\n    return;\n  }\n  function accumulate(id) {\n    if (!self._accumulatingId || id !== self._accumulatingId) {\n      return;\n    }\n    var isFinished = true;\n    for (var i = 0; i < self.views.length; i++) {\n      isFinished = self.views[i].isAccumulateFinished() && needsAccumulate;\n    }\n    if (!isFinished) {\n      self._doRender(true);\n      if (immediate) {\n        accumulate(id);\n      } else {\n        requestAnimationFrame(function () {\n          accumulate(id);\n        });\n      }\n    }\n  }\n  this._accumulatingId = accumulatingId++;\n  if (immediate) {\n    accumulate(self._accumulatingId);\n  } else {\n    this._accumulatingTimeout = setTimeout(function () {\n      accumulate(self._accumulatingId);\n    }, 50);\n  }\n};\nLayerGL.prototype._trackAndClean = function () {\n  var textureList = [];\n  var geometriesList = []; // Mark all resources unused;\n\n  if (this._textureList) {\n    markUnused(this._textureList);\n    markUnused(this._geometriesList);\n  }\n  for (var i = 0; i < this.views.length; i++) {\n    collectResources(this.views[i].scene, textureList, geometriesList);\n  } // Dispose those unsed resources.\n\n  if (this._textureList) {\n    checkAndDispose(this.renderer, this._textureList);\n    checkAndDispose(this.renderer, this._geometriesList);\n  }\n  this._textureList = textureList;\n  this._geometriesList = geometriesList;\n};\nfunction markUnused(resourceList) {\n  for (var i = 0; i < resourceList.length; i++) {\n    resourceList[i].__used__ = 0;\n  }\n}\nfunction checkAndDispose(renderer, resourceList) {\n  for (var i = 0; i < resourceList.length; i++) {\n    if (!resourceList[i].__used__) {\n      resourceList[i].dispose(renderer);\n    }\n  }\n}\nfunction updateUsed(resource, list) {\n  resource.__used__ = resource.__used__ || 0;\n  resource.__used__++;\n  if (resource.__used__ === 1) {\n    // Don't push to the list twice.\n    list.push(resource);\n  }\n}\nfunction collectResources(scene, textureResourceList, geometryResourceList) {\n  var prevMaterial;\n  var prevGeometry;\n  scene.traverse(function (renderable) {\n    if (renderable.isRenderable()) {\n      var geometry = renderable.geometry;\n      var material = renderable.material; // TODO optimize!!\n\n      if (material !== prevMaterial) {\n        var textureUniforms = material.getTextureUniforms();\n        for (var u = 0; u < textureUniforms.length; u++) {\n          var uniformName = textureUniforms[u];\n          var val = material.uniforms[uniformName].value;\n          if (!val) {\n            continue;\n          }\n          if (val instanceof Texture) {\n            updateUsed(val, textureResourceList);\n          } else if (val instanceof Array) {\n            for (var k = 0; k < val.length; k++) {\n              if (val[k] instanceof Texture) {\n                updateUsed(val[k], textureResourceList);\n              }\n            }\n          }\n        }\n      }\n      if (geometry !== prevGeometry) {\n        updateUsed(geometry, geometryResourceList);\n      }\n      prevMaterial = material;\n      prevGeometry = geometry;\n    }\n  });\n  for (var k = 0; k < scene.lights.length; k++) {\n    // Track AmbientCubemap\n    if (scene.lights[k].cubemap) {\n      updateUsed(scene.lights[k].cubemap, textureResourceList);\n    }\n  }\n}\n/**\n * Dispose the layer\n */\n\nLayerGL.prototype.dispose = function () {\n  if (this._disposed) {\n    return;\n  }\n  this._stopAccumulating();\n  if (this._textureList) {\n    markUnused(this._textureList);\n    markUnused(this._geometriesList);\n    checkAndDispose(this.renderer, this._textureList);\n    checkAndDispose(this.renderer, this._geometriesList);\n  }\n  this.zr.off('globalout', this.onglobalout);\n  this._disposed = true;\n}; // Event handlers\n\nLayerGL.prototype.onmousedown = function (e) {\n  if (e.target && e.target.__isGLToZRProxy) {\n    return;\n  }\n  e = e.event;\n  var obj = this.pickObject(e.offsetX, e.offsetY);\n  if (obj) {\n    this._dispatchEvent('mousedown', e, obj);\n    this._dispatchDataEvent('mousedown', e, obj);\n  }\n  this._downX = e.offsetX;\n  this._downY = e.offsetY;\n};\nLayerGL.prototype.onmousemove = function (e) {\n  if (e.target && e.target.__isGLToZRProxy) {\n    return;\n  }\n  e = e.event;\n  var obj = this.pickObject(e.offsetX, e.offsetY);\n  var target = obj && obj.target;\n  var lastHovered = this._hovered;\n  this._hovered = obj;\n  if (lastHovered && target !== lastHovered.target) {\n    lastHovered.relatedTarget = target;\n    this._dispatchEvent('mouseout', e, lastHovered); // this._dispatchDataEvent('mouseout', e, lastHovered);\n\n    this.zr.setCursorStyle('default');\n  }\n  this._dispatchEvent('mousemove', e, obj);\n  if (obj) {\n    this.zr.setCursorStyle('pointer');\n    if (!lastHovered || target !== lastHovered.target) {\n      this._dispatchEvent('mouseover', e, obj); // this._dispatchDataEvent('mouseover', e, obj);\n    }\n  }\n  this._dispatchDataEvent('mousemove', e, obj);\n};\nLayerGL.prototype.onmouseup = function (e) {\n  if (e.target && e.target.__isGLToZRProxy) {\n    return;\n  }\n  e = e.event;\n  var obj = this.pickObject(e.offsetX, e.offsetY);\n  if (obj) {\n    this._dispatchEvent('mouseup', e, obj);\n    this._dispatchDataEvent('mouseup', e, obj);\n  }\n  this._upX = e.offsetX;\n  this._upY = e.offsetY;\n};\nLayerGL.prototype.onclick = LayerGL.prototype.dblclick = function (e) {\n  if (e.target && e.target.__isGLToZRProxy) {\n    return;\n  } // Ignore click event if mouse moved\n\n  var dx = this._upX - this._downX;\n  var dy = this._upY - this._downY;\n  if (Math.sqrt(dx * dx + dy * dy) > 20) {\n    return;\n  }\n  e = e.event;\n  var obj = this.pickObject(e.offsetX, e.offsetY);\n  if (obj) {\n    this._dispatchEvent(e.type, e, obj);\n    this._dispatchDataEvent(e.type, e, obj);\n  } // Try set depth of field onclick\n\n  var result = this._clickToSetFocusPoint(e);\n  if (result) {\n    var success = result.view.setDOFFocusOnPoint(result.distance);\n    if (success) {\n      this.zr.refresh();\n    }\n  }\n};\nLayerGL.prototype._clickToSetFocusPoint = function (e) {\n  var renderer = this.renderer;\n  var oldViewport = renderer.viewport;\n  for (var i = this.views.length - 1; i >= 0; i--) {\n    var viewGL = this.views[i];\n    if (viewGL.hasDOF() && viewGL.containPoint(e.offsetX, e.offsetY)) {\n      this._picking.scene = viewGL.scene;\n      this._picking.camera = viewGL.camera; // Only used for picking, renderer.setViewport will also invoke gl.viewport.\n      // Set directly, PENDING.\n\n      renderer.viewport = viewGL.viewport;\n      var result = this._picking.pick(e.offsetX, e.offsetY, true);\n      if (result) {\n        result.view = viewGL;\n        return result;\n      }\n    }\n  }\n  renderer.viewport = oldViewport;\n};\nLayerGL.prototype.onglobalout = function (e) {\n  var lastHovered = this._hovered;\n  if (lastHovered) {\n    this._dispatchEvent('mouseout', e, {\n      target: lastHovered.target\n    });\n  }\n};\nLayerGL.prototype.pickObject = function (x, y) {\n  var output = [];\n  var renderer = this.renderer;\n  var oldViewport = renderer.viewport;\n  for (var i = 0; i < this.views.length; i++) {\n    var viewGL = this.views[i];\n    if (viewGL.containPoint(x, y)) {\n      this._picking.scene = viewGL.scene;\n      this._picking.camera = viewGL.camera; // Only used for picking, renderer.setViewport will also invoke gl.viewport.\n      // Set directly, PENDING.\n\n      renderer.viewport = viewGL.viewport;\n      this._picking.pickAll(x, y, output);\n    }\n  }\n  renderer.viewport = oldViewport;\n  output.sort(function (a, b) {\n    return a.distance - b.distance;\n  });\n  return output[0];\n};\nLayerGL.prototype._dispatchEvent = function (eveName, originalEvent, newEvent) {\n  if (!newEvent) {\n    newEvent = {};\n  }\n  var current = newEvent.target;\n  newEvent.cancelBubble = false;\n  newEvent.event = originalEvent;\n  newEvent.type = eveName;\n  newEvent.offsetX = originalEvent.offsetX;\n  newEvent.offsetY = originalEvent.offsetY;\n  while (current) {\n    current.trigger(eveName, newEvent);\n    current = current.getParent();\n    if (newEvent.cancelBubble) {\n      break;\n    }\n  }\n  this._dispatchToView(eveName, newEvent);\n};\nLayerGL.prototype._dispatchDataEvent = function (eveName, originalEvent, newEvent) {\n  var mesh = newEvent && newEvent.target;\n  var dataIndex = mesh && mesh.dataIndex;\n  var seriesIndex = mesh && mesh.seriesIndex; // Custom event data\n\n  var eventData = mesh && mesh.eventData;\n  var elChangedInMouseMove = false;\n  var eventProxy = this._zrEventProxy;\n  eventProxy.x = originalEvent.offsetX;\n  eventProxy.y = originalEvent.offsetY;\n  eventProxy.update();\n  var targetInfo = {\n    target: eventProxy\n  };\n  const ecData = echarts.helper.getECData(eventProxy);\n  if (eveName === 'mousemove') {\n    if (dataIndex != null) {\n      if (dataIndex !== this._lastDataIndex) {\n        if (parseInt(this._lastDataIndex, 10) >= 0) {\n          ecData.dataIndex = this._lastDataIndex;\n          ecData.seriesIndex = this._lastSeriesIndex; // FIXME May cause double events.\n\n          this.zr.handler.dispatchToElement(targetInfo, 'mouseout', originalEvent);\n        }\n        elChangedInMouseMove = true;\n      }\n    } else if (eventData != null) {\n      if (eventData !== this._lastEventData) {\n        if (this._lastEventData != null) {\n          ecData.eventData = this._lastEventData; // FIXME May cause double events.\n\n          this.zr.handler.dispatchToElement(targetInfo, 'mouseout', originalEvent);\n        }\n        elChangedInMouseMove = true;\n      }\n    }\n    this._lastEventData = eventData;\n    this._lastDataIndex = dataIndex;\n    this._lastSeriesIndex = seriesIndex;\n  }\n  ecData.eventData = eventData;\n  ecData.dataIndex = dataIndex;\n  ecData.seriesIndex = seriesIndex;\n  if (eventData != null || parseInt(dataIndex, 10) >= 0 && parseInt(seriesIndex, 10) >= 0) {\n    this.zr.handler.dispatchToElement(targetInfo, eveName, originalEvent);\n    if (elChangedInMouseMove) {\n      this.zr.handler.dispatchToElement(targetInfo, 'mouseover', originalEvent);\n    }\n  }\n};\nLayerGL.prototype._dispatchToView = function (eventName, e) {\n  for (var i = 0; i < this.views.length; i++) {\n    if (this.views[i].containPoint(e.offsetX, e.offsetY)) {\n      this.views[i].trigger(eventName, e);\n    }\n  }\n};\nObject.assign(LayerGL.prototype, notifier);\nexport default LayerGL;","map":{"version":3,"names":["echarts","Renderer","RayPicking","Texture","graphicGL","notifier","requestAnimationFrame","LayerGL","id","zr","renderer","clearBit","devicePixelRatio","painter","dpr","preserveDrawingBuffer","premultipliedAlpha","resize","getWidth","getHeight","e","dom","document","createElement","style","cssText","className","innerHTML","console","error","onglobalout","bind","on","canvas","position","left","top","views","_picking","_viewsToDispose","_accumulatingId","_zrEventProxy","graphic","Rect","shape","x","y","width","height","__isGLToZRProxy","_backgroundColor","_disposed","prototype","setUnpainted","addView","view","layer","idx","indexOf","splice","push","scene","traverse","node","__zr","addAnimatorsToZr","removeFromZr","removeAnimatorsFromZr","removeView","removeViewsAll","forEach","length","clear","gl","clearColor","depthMask","colorMask","DEPTH_BUFFER_BIT","COLOR_BUFFER_BIT","clearDepth","needsRefresh","refresh","bgColor","parseColor","i","prepareRender","_doRender","_trackAndClean","dispose","_startAccumulating","renderToCanvas","ctx","drawImage","accumulating","saveViewport","render","restoreViewport","_stopAccumulating","clearTimeout","_accumulatingTimeout","accumulatingId","immediate","self","needsAccumulate","accumulate","isFinished","isAccumulateFinished","setTimeout","textureList","geometriesList","_textureList","markUnused","_geometriesList","collectResources","checkAndDispose","resourceList","__used__","updateUsed","resource","list","textureResourceList","geometryResourceList","prevMaterial","prevGeometry","renderable","isRenderable","geometry","material","textureUniforms","getTextureUniforms","u","uniformName","val","uniforms","value","Array","k","lights","cubemap","off","onmousedown","target","event","obj","pickObject","offsetX","offsetY","_dispatchEvent","_dispatchDataEvent","_downX","_downY","onmousemove","lastHovered","_hovered","relatedTarget","setCursorStyle","onmouseup","_upX","_upY","onclick","dblclick","dx","dy","Math","sqrt","type","result","_clickToSetFocusPoint","success","setDOFFocusOnPoint","distance","oldViewport","viewport","viewGL","hasDOF","containPoint","camera","pick","output","pickAll","sort","a","b","eveName","originalEvent","newEvent","current","cancelBubble","trigger","getParent","_dispatchToView","mesh","dataIndex","seriesIndex","eventData","elChangedInMouseMove","eventProxy","update","targetInfo","ecData","helper","getECData","_lastDataIndex","parseInt","_lastSeriesIndex","handler","dispatchToElement","_lastEventData","eventName","Object","assign"],"sources":["E:/mytest/node_modules/echarts-gl/lib/core/LayerGL.js"],"sourcesContent":["/**\n * Provide WebGL layer to zrender. Which is rendered on top of clay.\n *\n *\n * Relationship between zrender, LayerGL(renderer) and ViewGL(Scene, Camera, Viewport)\n *           zrender\n *           /     \\\n *      LayerGL   LayerGL\n *    (renderer) (renderer)\n *      /     \\\n *  ViewGL   ViewGL\n */\nimport * as echarts from 'echarts/lib/echarts';\nimport Renderer from 'claygl/src/Renderer';\nimport RayPicking from 'claygl/src/picking/RayPicking';\nimport Texture from 'claygl/src/Texture';\nimport graphicGL from '../util/graphicGL'; // PENDING, clay. notifier is same with zrender Eventful\n\nimport notifier from 'claygl/src/core/mixin/notifier';\nimport requestAnimationFrame from 'zrender/lib/animation/requestAnimationFrame';\n/**\n * @constructor\n * @alias module:echarts-gl/core/LayerGL\n * @param {string} id Layer ID\n * @param {module:zrender/ZRender} zr\n */\n\nvar LayerGL = function (id, zr) {\n  /**\n   * Layer ID\n   * @type {string}\n   */\n  this.id = id;\n  /**\n   * @type {module:zrender/ZRender}\n   */\n\n  this.zr = zr;\n  /**\n   * @type {clay.Renderer}\n   */\n\n  try {\n    this.renderer = new Renderer({\n      clearBit: 0,\n      devicePixelRatio: zr.painter.dpr,\n      preserveDrawingBuffer: true,\n      // PENDING\n      premultipliedAlpha: true\n    });\n    this.renderer.resize(zr.painter.getWidth(), zr.painter.getHeight());\n  } catch (e) {\n    this.renderer = null;\n    this.dom = document.createElement('div');\n    this.dom.style.cssText = 'position:absolute; left: 0; top: 0; right: 0; bottom: 0;';\n    this.dom.className = 'ecgl-nowebgl';\n    this.dom.innerHTML = 'Sorry, your browser does not support WebGL';\n    console.error(e);\n    return;\n  }\n\n  this.onglobalout = this.onglobalout.bind(this);\n  zr.on('globalout', this.onglobalout);\n  /**\n   * Canvas dom for webgl rendering\n   * @type {HTMLCanvasElement}\n   */\n\n  this.dom = this.renderer.canvas;\n  var style = this.dom.style;\n  style.position = 'absolute';\n  style.left = '0';\n  style.top = '0';\n  /**\n   * @type {Array.<clay.Scene>}\n   */\n\n  this.views = [];\n  this._picking = new RayPicking({\n    renderer: this.renderer\n  });\n  this._viewsToDispose = [];\n  /**\n   * Current accumulating id.\n   */\n\n  this._accumulatingId = 0;\n  this._zrEventProxy = new echarts.graphic.Rect({\n    shape: {\n      x: -1,\n      y: -1,\n      width: 2,\n      height: 2\n    },\n    // FIXME Better solution.\n    __isGLToZRProxy: true\n  });\n  this._backgroundColor = null;\n  this._disposed = false;\n};\n\nLayerGL.prototype.setUnpainted = function () {};\n/**\n * @param {module:echarts-gl/core/ViewGL} view\n */\n\n\nLayerGL.prototype.addView = function (view) {\n  if (view.layer === this) {\n    return;\n  } // If needs to dispose in this layer. unmark it.\n\n\n  var idx = this._viewsToDispose.indexOf(view);\n\n  if (idx >= 0) {\n    this._viewsToDispose.splice(idx, 1);\n  }\n\n  this.views.push(view);\n  view.layer = this;\n  var zr = this.zr;\n  view.scene.traverse(function (node) {\n    node.__zr = zr;\n\n    if (node.addAnimatorsToZr) {\n      node.addAnimatorsToZr(zr);\n    }\n  });\n};\n\nfunction removeFromZr(node) {\n  var zr = node.__zr;\n  node.__zr = null;\n\n  if (zr && node.removeAnimatorsFromZr) {\n    node.removeAnimatorsFromZr(zr);\n  }\n}\n/**\n * @param {module:echarts-gl/core/ViewGL} view\n */\n\n\nLayerGL.prototype.removeView = function (view) {\n  if (view.layer !== this) {\n    return;\n  }\n\n  var idx = this.views.indexOf(view);\n\n  if (idx >= 0) {\n    this.views.splice(idx, 1);\n    view.scene.traverse(removeFromZr, this);\n    view.layer = null; // Mark to dispose in this layer.\n\n    this._viewsToDispose.push(view);\n  }\n};\n/**\n * Remove all views\n */\n\n\nLayerGL.prototype.removeViewsAll = function () {\n  this.views.forEach(function (view) {\n    view.scene.traverse(removeFromZr, this);\n    view.layer = null; // Mark to dispose in this layer.\n\n    this._viewsToDispose.push(view);\n  }, this);\n  this.views.length = 0;\n};\n/**\n * Resize the canvas and viewport, will be invoked by zrender\n * @param  {number} width\n * @param  {number} height\n */\n\n\nLayerGL.prototype.resize = function (width, height) {\n  var renderer = this.renderer;\n  renderer.resize(width, height);\n};\n/**\n * Clear color and depth\n * @return {[type]} [description]\n */\n\n\nLayerGL.prototype.clear = function () {\n  var gl = this.renderer.gl;\n  var clearColor = this._backgroundColor || [0, 0, 0, 0];\n  gl.clearColor(clearColor[0], clearColor[1], clearColor[2], clearColor[3]);\n  gl.depthMask(true);\n  gl.colorMask(true, true, true, true);\n  gl.clear(gl.DEPTH_BUFFER_BIT | gl.COLOR_BUFFER_BIT);\n};\n/**\n * Clear depth\n */\n\n\nLayerGL.prototype.clearDepth = function () {\n  var gl = this.renderer.gl;\n  gl.clear(gl.DEPTH_BUFFER_BIT);\n};\n/**\n * Clear color\n */\n\n\nLayerGL.prototype.clearColor = function () {\n  var gl = this.renderer.gl;\n  gl.clearColor(0, 0, 0, 0);\n  gl.clear(gl.COLOR_BUFFER_BIT);\n};\n/**\n * Mark layer to refresh next tick\n */\n\n\nLayerGL.prototype.needsRefresh = function () {\n  this.zr.refresh();\n};\n/**\n * Refresh the layer, will be invoked by zrender\n */\n\n\nLayerGL.prototype.refresh = function (bgColor) {\n  this._backgroundColor = bgColor ? graphicGL.parseColor(bgColor) : [0, 0, 0, 0];\n  this.renderer.clearColor = this._backgroundColor;\n\n  for (var i = 0; i < this.views.length; i++) {\n    this.views[i].prepareRender(this.renderer);\n  }\n\n  this._doRender(false); // Auto dispose unused resources on GPU, like program(shader), texture, geometry(buffers)\n\n\n  this._trackAndClean(); // Dispose trashed views\n\n\n  for (var i = 0; i < this._viewsToDispose.length; i++) {\n    this._viewsToDispose[i].dispose(this.renderer);\n  }\n\n  this._viewsToDispose.length = 0;\n\n  this._startAccumulating();\n};\n\nLayerGL.prototype.renderToCanvas = function (ctx) {\n  // PENDING will block the page\n  this._startAccumulating(true);\n\n  ctx.drawImage(this.dom, 0, 0, ctx.canvas.width, ctx.canvas.height);\n};\n\nLayerGL.prototype._doRender = function (accumulating) {\n  this.clear();\n  this.renderer.saveViewport();\n\n  for (var i = 0; i < this.views.length; i++) {\n    this.views[i].render(this.renderer, accumulating);\n  }\n\n  this.renderer.restoreViewport();\n};\n/**\n * Stop accumulating\n */\n\n\nLayerGL.prototype._stopAccumulating = function () {\n  this._accumulatingId = 0;\n  clearTimeout(this._accumulatingTimeout);\n};\n\nvar accumulatingId = 1;\n/**\n * Start accumulating all the views.\n * Accumulating is for antialising and have more sampling in SSAO\n * @private\n */\n\nLayerGL.prototype._startAccumulating = function (immediate) {\n  var self = this;\n\n  this._stopAccumulating();\n\n  var needsAccumulate = false;\n\n  for (var i = 0; i < this.views.length; i++) {\n    needsAccumulate = this.views[i].needsAccumulate() || needsAccumulate;\n  }\n\n  if (!needsAccumulate) {\n    return;\n  }\n\n  function accumulate(id) {\n    if (!self._accumulatingId || id !== self._accumulatingId) {\n      return;\n    }\n\n    var isFinished = true;\n\n    for (var i = 0; i < self.views.length; i++) {\n      isFinished = self.views[i].isAccumulateFinished() && needsAccumulate;\n    }\n\n    if (!isFinished) {\n      self._doRender(true);\n\n      if (immediate) {\n        accumulate(id);\n      } else {\n        requestAnimationFrame(function () {\n          accumulate(id);\n        });\n      }\n    }\n  }\n\n  this._accumulatingId = accumulatingId++;\n\n  if (immediate) {\n    accumulate(self._accumulatingId);\n  } else {\n    this._accumulatingTimeout = setTimeout(function () {\n      accumulate(self._accumulatingId);\n    }, 50);\n  }\n};\n\nLayerGL.prototype._trackAndClean = function () {\n  var textureList = [];\n  var geometriesList = []; // Mark all resources unused;\n\n  if (this._textureList) {\n    markUnused(this._textureList);\n    markUnused(this._geometriesList);\n  }\n\n  for (var i = 0; i < this.views.length; i++) {\n    collectResources(this.views[i].scene, textureList, geometriesList);\n  } // Dispose those unsed resources.\n\n\n  if (this._textureList) {\n    checkAndDispose(this.renderer, this._textureList);\n    checkAndDispose(this.renderer, this._geometriesList);\n  }\n\n  this._textureList = textureList;\n  this._geometriesList = geometriesList;\n};\n\nfunction markUnused(resourceList) {\n  for (var i = 0; i < resourceList.length; i++) {\n    resourceList[i].__used__ = 0;\n  }\n}\n\nfunction checkAndDispose(renderer, resourceList) {\n  for (var i = 0; i < resourceList.length; i++) {\n    if (!resourceList[i].__used__) {\n      resourceList[i].dispose(renderer);\n    }\n  }\n}\n\nfunction updateUsed(resource, list) {\n  resource.__used__ = resource.__used__ || 0;\n  resource.__used__++;\n\n  if (resource.__used__ === 1) {\n    // Don't push to the list twice.\n    list.push(resource);\n  }\n}\n\nfunction collectResources(scene, textureResourceList, geometryResourceList) {\n  var prevMaterial;\n  var prevGeometry;\n  scene.traverse(function (renderable) {\n    if (renderable.isRenderable()) {\n      var geometry = renderable.geometry;\n      var material = renderable.material; // TODO optimize!!\n\n      if (material !== prevMaterial) {\n        var textureUniforms = material.getTextureUniforms();\n\n        for (var u = 0; u < textureUniforms.length; u++) {\n          var uniformName = textureUniforms[u];\n          var val = material.uniforms[uniformName].value;\n\n          if (!val) {\n            continue;\n          }\n\n          if (val instanceof Texture) {\n            updateUsed(val, textureResourceList);\n          } else if (val instanceof Array) {\n            for (var k = 0; k < val.length; k++) {\n              if (val[k] instanceof Texture) {\n                updateUsed(val[k], textureResourceList);\n              }\n            }\n          }\n        }\n      }\n\n      if (geometry !== prevGeometry) {\n        updateUsed(geometry, geometryResourceList);\n      }\n\n      prevMaterial = material;\n      prevGeometry = geometry;\n    }\n  });\n\n  for (var k = 0; k < scene.lights.length; k++) {\n    // Track AmbientCubemap\n    if (scene.lights[k].cubemap) {\n      updateUsed(scene.lights[k].cubemap, textureResourceList);\n    }\n  }\n}\n/**\n * Dispose the layer\n */\n\n\nLayerGL.prototype.dispose = function () {\n  if (this._disposed) {\n    return;\n  }\n\n  this._stopAccumulating();\n\n  if (this._textureList) {\n    markUnused(this._textureList);\n    markUnused(this._geometriesList);\n    checkAndDispose(this.renderer, this._textureList);\n    checkAndDispose(this.renderer, this._geometriesList);\n  }\n\n  this.zr.off('globalout', this.onglobalout);\n  this._disposed = true;\n}; // Event handlers\n\n\nLayerGL.prototype.onmousedown = function (e) {\n  if (e.target && e.target.__isGLToZRProxy) {\n    return;\n  }\n\n  e = e.event;\n  var obj = this.pickObject(e.offsetX, e.offsetY);\n\n  if (obj) {\n    this._dispatchEvent('mousedown', e, obj);\n\n    this._dispatchDataEvent('mousedown', e, obj);\n  }\n\n  this._downX = e.offsetX;\n  this._downY = e.offsetY;\n};\n\nLayerGL.prototype.onmousemove = function (e) {\n  if (e.target && e.target.__isGLToZRProxy) {\n    return;\n  }\n\n  e = e.event;\n  var obj = this.pickObject(e.offsetX, e.offsetY);\n  var target = obj && obj.target;\n  var lastHovered = this._hovered;\n  this._hovered = obj;\n\n  if (lastHovered && target !== lastHovered.target) {\n    lastHovered.relatedTarget = target;\n\n    this._dispatchEvent('mouseout', e, lastHovered); // this._dispatchDataEvent('mouseout', e, lastHovered);\n\n\n    this.zr.setCursorStyle('default');\n  }\n\n  this._dispatchEvent('mousemove', e, obj);\n\n  if (obj) {\n    this.zr.setCursorStyle('pointer');\n\n    if (!lastHovered || target !== lastHovered.target) {\n      this._dispatchEvent('mouseover', e, obj); // this._dispatchDataEvent('mouseover', e, obj);\n\n    }\n  }\n\n  this._dispatchDataEvent('mousemove', e, obj);\n};\n\nLayerGL.prototype.onmouseup = function (e) {\n  if (e.target && e.target.__isGLToZRProxy) {\n    return;\n  }\n\n  e = e.event;\n  var obj = this.pickObject(e.offsetX, e.offsetY);\n\n  if (obj) {\n    this._dispatchEvent('mouseup', e, obj);\n\n    this._dispatchDataEvent('mouseup', e, obj);\n  }\n\n  this._upX = e.offsetX;\n  this._upY = e.offsetY;\n};\n\nLayerGL.prototype.onclick = LayerGL.prototype.dblclick = function (e) {\n  if (e.target && e.target.__isGLToZRProxy) {\n    return;\n  } // Ignore click event if mouse moved\n\n\n  var dx = this._upX - this._downX;\n  var dy = this._upY - this._downY;\n\n  if (Math.sqrt(dx * dx + dy * dy) > 20) {\n    return;\n  }\n\n  e = e.event;\n  var obj = this.pickObject(e.offsetX, e.offsetY);\n\n  if (obj) {\n    this._dispatchEvent(e.type, e, obj);\n\n    this._dispatchDataEvent(e.type, e, obj);\n  } // Try set depth of field onclick\n\n\n  var result = this._clickToSetFocusPoint(e);\n\n  if (result) {\n    var success = result.view.setDOFFocusOnPoint(result.distance);\n\n    if (success) {\n      this.zr.refresh();\n    }\n  }\n};\n\nLayerGL.prototype._clickToSetFocusPoint = function (e) {\n  var renderer = this.renderer;\n  var oldViewport = renderer.viewport;\n\n  for (var i = this.views.length - 1; i >= 0; i--) {\n    var viewGL = this.views[i];\n\n    if (viewGL.hasDOF() && viewGL.containPoint(e.offsetX, e.offsetY)) {\n      this._picking.scene = viewGL.scene;\n      this._picking.camera = viewGL.camera; // Only used for picking, renderer.setViewport will also invoke gl.viewport.\n      // Set directly, PENDING.\n\n      renderer.viewport = viewGL.viewport;\n\n      var result = this._picking.pick(e.offsetX, e.offsetY, true);\n\n      if (result) {\n        result.view = viewGL;\n        return result;\n      }\n    }\n  }\n\n  renderer.viewport = oldViewport;\n};\n\nLayerGL.prototype.onglobalout = function (e) {\n  var lastHovered = this._hovered;\n\n  if (lastHovered) {\n    this._dispatchEvent('mouseout', e, {\n      target: lastHovered.target\n    });\n  }\n};\n\nLayerGL.prototype.pickObject = function (x, y) {\n  var output = [];\n  var renderer = this.renderer;\n  var oldViewport = renderer.viewport;\n\n  for (var i = 0; i < this.views.length; i++) {\n    var viewGL = this.views[i];\n\n    if (viewGL.containPoint(x, y)) {\n      this._picking.scene = viewGL.scene;\n      this._picking.camera = viewGL.camera; // Only used for picking, renderer.setViewport will also invoke gl.viewport.\n      // Set directly, PENDING.\n\n      renderer.viewport = viewGL.viewport;\n\n      this._picking.pickAll(x, y, output);\n    }\n  }\n\n  renderer.viewport = oldViewport;\n  output.sort(function (a, b) {\n    return a.distance - b.distance;\n  });\n  return output[0];\n};\n\nLayerGL.prototype._dispatchEvent = function (eveName, originalEvent, newEvent) {\n  if (!newEvent) {\n    newEvent = {};\n  }\n\n  var current = newEvent.target;\n  newEvent.cancelBubble = false;\n  newEvent.event = originalEvent;\n  newEvent.type = eveName;\n  newEvent.offsetX = originalEvent.offsetX;\n  newEvent.offsetY = originalEvent.offsetY;\n\n  while (current) {\n    current.trigger(eveName, newEvent);\n    current = current.getParent();\n\n    if (newEvent.cancelBubble) {\n      break;\n    }\n  }\n\n  this._dispatchToView(eveName, newEvent);\n};\n\nLayerGL.prototype._dispatchDataEvent = function (eveName, originalEvent, newEvent) {\n  var mesh = newEvent && newEvent.target;\n  var dataIndex = mesh && mesh.dataIndex;\n  var seriesIndex = mesh && mesh.seriesIndex; // Custom event data\n\n  var eventData = mesh && mesh.eventData;\n  var elChangedInMouseMove = false;\n  var eventProxy = this._zrEventProxy;\n  eventProxy.x = originalEvent.offsetX;\n  eventProxy.y = originalEvent.offsetY;\n  eventProxy.update();\n  var targetInfo = {\n    target: eventProxy\n  };\n  const ecData = echarts.helper.getECData(eventProxy);\n\n  if (eveName === 'mousemove') {\n    if (dataIndex != null) {\n      if (dataIndex !== this._lastDataIndex) {\n        if (parseInt(this._lastDataIndex, 10) >= 0) {\n          ecData.dataIndex = this._lastDataIndex;\n          ecData.seriesIndex = this._lastSeriesIndex; // FIXME May cause double events.\n\n          this.zr.handler.dispatchToElement(targetInfo, 'mouseout', originalEvent);\n        }\n\n        elChangedInMouseMove = true;\n      }\n    } else if (eventData != null) {\n      if (eventData !== this._lastEventData) {\n        if (this._lastEventData != null) {\n          ecData.eventData = this._lastEventData; // FIXME May cause double events.\n\n          this.zr.handler.dispatchToElement(targetInfo, 'mouseout', originalEvent);\n        }\n\n        elChangedInMouseMove = true;\n      }\n    }\n\n    this._lastEventData = eventData;\n    this._lastDataIndex = dataIndex;\n    this._lastSeriesIndex = seriesIndex;\n  }\n\n  ecData.eventData = eventData;\n  ecData.dataIndex = dataIndex;\n  ecData.seriesIndex = seriesIndex;\n\n  if (eventData != null || parseInt(dataIndex, 10) >= 0 && parseInt(seriesIndex, 10) >= 0) {\n    this.zr.handler.dispatchToElement(targetInfo, eveName, originalEvent);\n\n    if (elChangedInMouseMove) {\n      this.zr.handler.dispatchToElement(targetInfo, 'mouseover', originalEvent);\n    }\n  }\n};\n\nLayerGL.prototype._dispatchToView = function (eventName, e) {\n  for (var i = 0; i < this.views.length; i++) {\n    if (this.views[i].containPoint(e.offsetX, e.offsetY)) {\n      this.views[i].trigger(eventName, e);\n    }\n  }\n};\n\nObject.assign(LayerGL.prototype, notifier);\nexport default LayerGL;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}