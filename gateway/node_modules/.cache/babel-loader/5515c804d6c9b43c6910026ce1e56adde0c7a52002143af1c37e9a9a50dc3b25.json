{"ast":null,"code":"import * as echarts from 'echarts/lib/echarts';\nimport glmatrix from 'claygl/src/dep/glmatrix';\nvar vec3 = glmatrix.vec3;\nvar isDimensionStacked = echarts.helper.dataStack.isDimensionStacked;\nfunction ifCrossZero(extent) {\n  var min = extent[0];\n  var max = extent[1];\n  return !(min > 0 && max > 0 || min < 0 && max < 0);\n}\n;\nfunction cartesian3DLayout(seriesModel, coordSys) {\n  var data = seriesModel.getData(); // var barOnPlane = seriesModel.get('onGridPlane');\n\n  var barSize = seriesModel.get('barSize');\n  if (barSize == null) {\n    var size = coordSys.size;\n    var barWidth;\n    var barDepth;\n    var xAxis = coordSys.getAxis('x');\n    var yAxis = coordSys.getAxis('y');\n    if (xAxis.type === 'category') {\n      barWidth = xAxis.getBandWidth() * 0.7;\n    } else {\n      // PENDING\n      barWidth = Math.round(size[0] / Math.sqrt(data.count())) * 0.6;\n    }\n    if (yAxis.type === 'category') {\n      barDepth = yAxis.getBandWidth() * 0.7;\n    } else {\n      barDepth = Math.round(size[1] / Math.sqrt(data.count())) * 0.6;\n    }\n    barSize = [barWidth, barDepth];\n  } else if (!echarts.util.isArray(barSize)) {\n    barSize = [barSize, barSize];\n  }\n  var zAxisExtent = coordSys.getAxis('z').scale.getExtent();\n  var ifZAxisCrossZero = ifCrossZero(zAxisExtent);\n  var dims = ['x', 'y', 'z'].map(function (coordDimName) {\n    return seriesModel.coordDimToDataDim(coordDimName)[0];\n  });\n  var isStacked = isDimensionStacked(data, dims[2]);\n  var valueDim = isStacked ? data.getCalculationInfo('stackResultDimension') : dims[2];\n  data.each(dims, function (x, y, z, idx) {\n    // TODO zAxis is inversed\n    // TODO On different plane.\n    var stackedValue = data.get(valueDim, idx);\n    var baseValue = isStacked ? stackedValue - z : ifZAxisCrossZero ? 0 : zAxisExtent[0];\n    var start = coordSys.dataToPoint([x, y, baseValue]);\n    var end = coordSys.dataToPoint([x, y, stackedValue]);\n    var height = vec3.dist(start, end); // PENDING When zAxis is not cross zero.\n\n    var dir = [0, end[1] < start[1] ? -1 : 1, 0];\n    if (Math.abs(height) === 0) {\n      // TODO\n      height = 0.1;\n    }\n    var size = [barSize[0], height, barSize[1]];\n    data.setItemLayout(idx, [start, dir, size]);\n  });\n  data.setLayout('orient', [1, 0, 0]);\n}\nexport default cartesian3DLayout;","map":{"version":3,"names":["echarts","glmatrix","vec3","isDimensionStacked","helper","dataStack","ifCrossZero","extent","min","max","cartesian3DLayout","seriesModel","coordSys","data","getData","barSize","get","size","barWidth","barDepth","xAxis","getAxis","yAxis","type","getBandWidth","Math","round","sqrt","count","util","isArray","zAxisExtent","scale","getExtent","ifZAxisCrossZero","dims","map","coordDimName","coordDimToDataDim","isStacked","valueDim","getCalculationInfo","each","x","y","z","idx","stackedValue","baseValue","start","dataToPoint","end","height","dist","dir","abs","setItemLayout","setLayout"],"sources":["E:/QuestionairePlanet_Fronted/mytest/node_modules/echarts-gl/lib/chart/bar3D/cartesian3DLayout.js"],"sourcesContent":["import * as echarts from 'echarts/lib/echarts';\nimport glmatrix from 'claygl/src/dep/glmatrix';\nvar vec3 = glmatrix.vec3;\nvar isDimensionStacked = echarts.helper.dataStack.isDimensionStacked;\n\nfunction ifCrossZero(extent) {\n  var min = extent[0];\n  var max = extent[1];\n  return !(min > 0 && max > 0 || min < 0 && max < 0);\n}\n\n;\n\nfunction cartesian3DLayout(seriesModel, coordSys) {\n  var data = seriesModel.getData(); // var barOnPlane = seriesModel.get('onGridPlane');\n\n  var barSize = seriesModel.get('barSize');\n\n  if (barSize == null) {\n    var size = coordSys.size;\n    var barWidth;\n    var barDepth;\n    var xAxis = coordSys.getAxis('x');\n    var yAxis = coordSys.getAxis('y');\n\n    if (xAxis.type === 'category') {\n      barWidth = xAxis.getBandWidth() * 0.7;\n    } else {\n      // PENDING\n      barWidth = Math.round(size[0] / Math.sqrt(data.count())) * 0.6;\n    }\n\n    if (yAxis.type === 'category') {\n      barDepth = yAxis.getBandWidth() * 0.7;\n    } else {\n      barDepth = Math.round(size[1] / Math.sqrt(data.count())) * 0.6;\n    }\n\n    barSize = [barWidth, barDepth];\n  } else if (!echarts.util.isArray(barSize)) {\n    barSize = [barSize, barSize];\n  }\n\n  var zAxisExtent = coordSys.getAxis('z').scale.getExtent();\n  var ifZAxisCrossZero = ifCrossZero(zAxisExtent);\n  var dims = ['x', 'y', 'z'].map(function (coordDimName) {\n    return seriesModel.coordDimToDataDim(coordDimName)[0];\n  });\n  var isStacked = isDimensionStacked(data, dims[2]);\n  var valueDim = isStacked ? data.getCalculationInfo('stackResultDimension') : dims[2];\n  data.each(dims, function (x, y, z, idx) {\n    // TODO zAxis is inversed\n    // TODO On different plane.\n    var stackedValue = data.get(valueDim, idx);\n    var baseValue = isStacked ? stackedValue - z : ifZAxisCrossZero ? 0 : zAxisExtent[0];\n    var start = coordSys.dataToPoint([x, y, baseValue]);\n    var end = coordSys.dataToPoint([x, y, stackedValue]);\n    var height = vec3.dist(start, end); // PENDING When zAxis is not cross zero.\n\n    var dir = [0, end[1] < start[1] ? -1 : 1, 0];\n\n    if (Math.abs(height) === 0) {\n      // TODO\n      height = 0.1;\n    }\n\n    var size = [barSize[0], height, barSize[1]];\n    data.setItemLayout(idx, [start, dir, size]);\n  });\n  data.setLayout('orient', [1, 0, 0]);\n}\n\nexport default cartesian3DLayout;"],"mappings":"AAAA,OAAO,KAAKA,OAAO,MAAM,qBAAqB;AAC9C,OAAOC,QAAQ,MAAM,yBAAyB;AAC9C,IAAIC,IAAI,GAAGD,QAAQ,CAACC,IAAI;AACxB,IAAIC,kBAAkB,GAAGH,OAAO,CAACI,MAAM,CAACC,SAAS,CAACF,kBAAkB;AAEpE,SAASG,WAAWA,CAACC,MAAM,EAAE;EAC3B,IAAIC,GAAG,GAAGD,MAAM,CAAC,CAAC,CAAC;EACnB,IAAIE,GAAG,GAAGF,MAAM,CAAC,CAAC,CAAC;EACnB,OAAO,EAAEC,GAAG,GAAG,CAAC,IAAIC,GAAG,GAAG,CAAC,IAAID,GAAG,GAAG,CAAC,IAAIC,GAAG,GAAG,CAAC,CAAC;AACpD;AAEA;AAEA,SAASC,iBAAiBA,CAACC,WAAW,EAAEC,QAAQ,EAAE;EAChD,IAAIC,IAAI,GAAGF,WAAW,CAACG,OAAO,CAAC,CAAC,CAAC,CAAC;;EAElC,IAAIC,OAAO,GAAGJ,WAAW,CAACK,GAAG,CAAC,SAAS,CAAC;EAExC,IAAID,OAAO,IAAI,IAAI,EAAE;IACnB,IAAIE,IAAI,GAAGL,QAAQ,CAACK,IAAI;IACxB,IAAIC,QAAQ;IACZ,IAAIC,QAAQ;IACZ,IAAIC,KAAK,GAAGR,QAAQ,CAACS,OAAO,CAAC,GAAG,CAAC;IACjC,IAAIC,KAAK,GAAGV,QAAQ,CAACS,OAAO,CAAC,GAAG,CAAC;IAEjC,IAAID,KAAK,CAACG,IAAI,KAAK,UAAU,EAAE;MAC7BL,QAAQ,GAAGE,KAAK,CAACI,YAAY,CAAC,CAAC,GAAG,GAAG;IACvC,CAAC,MAAM;MACL;MACAN,QAAQ,GAAGO,IAAI,CAACC,KAAK,CAACT,IAAI,CAAC,CAAC,CAAC,GAAGQ,IAAI,CAACE,IAAI,CAACd,IAAI,CAACe,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG;IAChE;IAEA,IAAIN,KAAK,CAACC,IAAI,KAAK,UAAU,EAAE;MAC7BJ,QAAQ,GAAGG,KAAK,CAACE,YAAY,CAAC,CAAC,GAAG,GAAG;IACvC,CAAC,MAAM;MACLL,QAAQ,GAAGM,IAAI,CAACC,KAAK,CAACT,IAAI,CAAC,CAAC,CAAC,GAAGQ,IAAI,CAACE,IAAI,CAACd,IAAI,CAACe,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG;IAChE;IAEAb,OAAO,GAAG,CAACG,QAAQ,EAAEC,QAAQ,CAAC;EAChC,CAAC,MAAM,IAAI,CAACnB,OAAO,CAAC6B,IAAI,CAACC,OAAO,CAACf,OAAO,CAAC,EAAE;IACzCA,OAAO,GAAG,CAACA,OAAO,EAAEA,OAAO,CAAC;EAC9B;EAEA,IAAIgB,WAAW,GAAGnB,QAAQ,CAACS,OAAO,CAAC,GAAG,CAAC,CAACW,KAAK,CAACC,SAAS,CAAC,CAAC;EACzD,IAAIC,gBAAgB,GAAG5B,WAAW,CAACyB,WAAW,CAAC;EAC/C,IAAII,IAAI,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAACC,GAAG,CAAC,UAAUC,YAAY,EAAE;IACrD,OAAO1B,WAAW,CAAC2B,iBAAiB,CAACD,YAAY,CAAC,CAAC,CAAC,CAAC;EACvD,CAAC,CAAC;EACF,IAAIE,SAAS,GAAGpC,kBAAkB,CAACU,IAAI,EAAEsB,IAAI,CAAC,CAAC,CAAC,CAAC;EACjD,IAAIK,QAAQ,GAAGD,SAAS,GAAG1B,IAAI,CAAC4B,kBAAkB,CAAC,sBAAsB,CAAC,GAAGN,IAAI,CAAC,CAAC,CAAC;EACpFtB,IAAI,CAAC6B,IAAI,CAACP,IAAI,EAAE,UAAUQ,CAAC,EAAEC,CAAC,EAAEC,CAAC,EAAEC,GAAG,EAAE;IACtC;IACA;IACA,IAAIC,YAAY,GAAGlC,IAAI,CAACG,GAAG,CAACwB,QAAQ,EAAEM,GAAG,CAAC;IAC1C,IAAIE,SAAS,GAAGT,SAAS,GAAGQ,YAAY,GAAGF,CAAC,GAAGX,gBAAgB,GAAG,CAAC,GAAGH,WAAW,CAAC,CAAC,CAAC;IACpF,IAAIkB,KAAK,GAAGrC,QAAQ,CAACsC,WAAW,CAAC,CAACP,CAAC,EAAEC,CAAC,EAAEI,SAAS,CAAC,CAAC;IACnD,IAAIG,GAAG,GAAGvC,QAAQ,CAACsC,WAAW,CAAC,CAACP,CAAC,EAAEC,CAAC,EAAEG,YAAY,CAAC,CAAC;IACpD,IAAIK,MAAM,GAAGlD,IAAI,CAACmD,IAAI,CAACJ,KAAK,EAAEE,GAAG,CAAC,CAAC,CAAC;;IAEpC,IAAIG,GAAG,GAAG,CAAC,CAAC,EAAEH,GAAG,CAAC,CAAC,CAAC,GAAGF,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;IAE5C,IAAIxB,IAAI,CAAC8B,GAAG,CAACH,MAAM,CAAC,KAAK,CAAC,EAAE;MAC1B;MACAA,MAAM,GAAG,GAAG;IACd;IAEA,IAAInC,IAAI,GAAG,CAACF,OAAO,CAAC,CAAC,CAAC,EAAEqC,MAAM,EAAErC,OAAO,CAAC,CAAC,CAAC,CAAC;IAC3CF,IAAI,CAAC2C,aAAa,CAACV,GAAG,EAAE,CAACG,KAAK,EAAEK,GAAG,EAAErC,IAAI,CAAC,CAAC;EAC7C,CAAC,CAAC;EACFJ,IAAI,CAAC4C,SAAS,CAAC,QAAQ,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;AACrC;AAEA,eAAe/C,iBAAiB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}