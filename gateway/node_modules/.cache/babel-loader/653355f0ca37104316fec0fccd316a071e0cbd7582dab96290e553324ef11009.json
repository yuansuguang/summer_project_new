{"ast":null,"code":"var DIRTY_PREFIX = '__dt__';\nvar Cache = function () {\n  this._contextId = 0;\n  this._caches = [];\n  this._context = {};\n};\nCache.prototype = {\n  use: function (contextId, documentSchema) {\n    var caches = this._caches;\n    if (!caches[contextId]) {\n      caches[contextId] = {};\n      if (documentSchema) {\n        caches[contextId] = documentSchema();\n      }\n    }\n    this._contextId = contextId;\n    this._context = caches[contextId];\n  },\n  put: function (key, value) {\n    this._context[key] = value;\n  },\n  get: function (key) {\n    return this._context[key];\n  },\n  dirty: function (field) {\n    field = field || '';\n    var key = DIRTY_PREFIX + field;\n    this.put(key, true);\n  },\n  dirtyAll: function (field) {\n    field = field || '';\n    var key = DIRTY_PREFIX + field;\n    var caches = this._caches;\n    for (var i = 0; i < caches.length; i++) {\n      if (caches[i]) {\n        caches[i][key] = true;\n      }\n    }\n  },\n  fresh: function (field) {\n    field = field || '';\n    var key = DIRTY_PREFIX + field;\n    this.put(key, false);\n  },\n  freshAll: function (field) {\n    field = field || '';\n    var key = DIRTY_PREFIX + field;\n    var caches = this._caches;\n    for (var i = 0; i < caches.length; i++) {\n      if (caches[i]) {\n        caches[i][key] = false;\n      }\n    }\n  },\n  isDirty: function (field) {\n    field = field || '';\n    var key = DIRTY_PREFIX + field;\n    var context = this._context;\n    return !context.hasOwnProperty(key) || context[key] === true;\n  },\n  deleteContext: function (contextId) {\n    delete this._caches[contextId];\n    this._context = {};\n  },\n  delete: function (key) {\n    delete this._context[key];\n  },\n  clearAll: function () {\n    this._caches = {};\n  },\n  getContext: function () {\n    return this._context;\n  },\n  eachContext: function (cb, context) {\n    var keys = Object.keys(this._caches);\n    keys.forEach(function (key) {\n      cb && cb.call(context, key);\n    });\n  },\n  miss: function (key) {\n    return !this._context.hasOwnProperty(key);\n  }\n};\nCache.prototype.constructor = Cache;\nexport default Cache;","map":{"version":3,"names":["DIRTY_PREFIX","Cache","_contextId","_caches","_context","prototype","use","contextId","documentSchema","caches","put","key","value","get","dirty","field","dirtyAll","i","length","fresh","freshAll","isDirty","context","hasOwnProperty","deleteContext","delete","clearAll","getContext","eachContext","cb","keys","Object","forEach","call","miss","constructor"],"sources":["E:/mytest/node_modules/claygl/src/core/Cache.js"],"sourcesContent":["var DIRTY_PREFIX = '__dt__';\n\nvar Cache = function () {\n\n    this._contextId = 0;\n\n    this._caches = [];\n\n    this._context = {};\n};\n\nCache.prototype = {\n\n    use: function (contextId, documentSchema) {\n        var caches = this._caches;\n        if (!caches[contextId]) {\n            caches[contextId] = {};\n\n            if (documentSchema) {\n                caches[contextId] = documentSchema();\n            }\n        }\n        this._contextId = contextId;\n\n        this._context = caches[contextId];\n    },\n\n    put: function (key, value) {\n        this._context[key] = value;\n    },\n\n    get: function (key) {\n        return this._context[key];\n    },\n\n    dirty: function (field) {\n        field = field || '';\n        var key = DIRTY_PREFIX + field;\n        this.put(key, true);\n    },\n\n    dirtyAll: function (field) {\n        field = field || '';\n        var key = DIRTY_PREFIX + field;\n        var caches = this._caches;\n        for (var i = 0; i < caches.length; i++) {\n            if (caches[i]) {\n                caches[i][key] = true;\n            }\n        }\n    },\n\n    fresh: function (field) {\n        field = field || '';\n        var key = DIRTY_PREFIX + field;\n        this.put(key, false);\n    },\n\n    freshAll: function (field) {\n        field = field || '';\n        var key = DIRTY_PREFIX + field;\n        var caches = this._caches;\n        for (var i = 0; i < caches.length; i++) {\n            if (caches[i]) {\n                caches[i][key] = false;\n            }\n        }\n    },\n\n    isDirty: function (field) {\n        field = field || '';\n        var key = DIRTY_PREFIX + field;\n        var context = this._context;\n        return  !context.hasOwnProperty(key)\n            || context[key] === true;\n    },\n\n    deleteContext: function (contextId) {\n        delete this._caches[contextId];\n        this._context = {};\n    },\n\n    delete: function (key) {\n        delete this._context[key];\n    },\n\n    clearAll: function () {\n        this._caches = {};\n    },\n\n    getContext: function () {\n        return this._context;\n    },\n\n    eachContext : function (cb, context) {\n        var keys = Object.keys(this._caches);\n        keys.forEach(function (key) {\n            cb && cb.call(context, key);\n        });\n    },\n\n    miss: function (key) {\n        return ! this._context.hasOwnProperty(key);\n    }\n};\n\nCache.prototype.constructor = Cache;\n\nexport default Cache;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}